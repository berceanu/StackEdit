<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>PIConGPULabBook</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h3 id="todos">TODOS</h3>
<ul>
<li>[x] HDF5 Spack debugging <span class="citation" data-cites="CETAL">@CETAL</span> <a href="https://github.com/ComputationalRadiationPhysics/picongpu/issues/2777">#2777</a></li>
<li>[x] run with less frequent <code>HDF5</code> output</li>
<li>[x] Nitrogen run <span class="citation" data-cites="CETAL">@CETAL</span> <span class="citation" data-cites="HOME">@HOME</span></li>
<li>[ ] Dubna install <a href="https://github.com/ComputationalRadiationPhysics/picongpu/issues/2752">#2752</a></li>
<li>[ ] make radiation python module compatible to other modules <a href="https://github.com/ComputationalRadiationPhysics/picongpu/issues/2778">#2778</a></li>
<li>[ ] PWFA references from <a href="https://paperpile.com/shared/OJUNKl">Downer et al</a></li>
<li>[ ] Spack development workflow <a href="https://github.com/ComputationalRadiationPhysics/picongpu/issues/2787">#2787</a> + <a href="https://www.sourcetrail.com">sourcetrail</a></li>
</ul>
<h4 id="next">next</h4>
<ul>
<li>[ ] PIConGPU @ Hypnos <code>hydrogen</code> <code>PWFA</code> <code>2D</code> <code>radiation plugin</code> <code>bunch acceleration</code></li>
<li>[ ] <a href="https://github.com/steindev/picongpu/tree/topic-2018_bunch-accel-ulf/share/picongpu/examples/BunchAcceleration">bunch acceleration example</a></li>
<li>[ ] macro-particle form factors for coherent and incoherent radiation <a href="http://dx.doi.org/10.5281/zenodo.1161232">zenodo</a></li>
</ul>
<h3 id="resources">Resources</h3>
<ul>
<li>Official <a href="https://github.com/ComputationalRadiationPhysics/picongpu">repository</a></li>
<li>Manual on <a href="https://picongpu.readthedocs.io/en/0.4.1/">readthedocs</a></li>
<li>Doxygen docs for the <a href="http://computationalradiationphysics.github.io/picongpu">API</a></li>
<li><a href="https://www.hzdr.de/db/Cms?pOid=31887&amp;pNid=0">Homepage</a></li>
<li>Project <a href="https://github.com/ComputationalRadiationPhysics/picongpu/wiki">wiki</a></li>
</ul>
<h3 id="bunch-acceleration-example">Bunch acceleration example</h3>
<blockquote>
<p>If you adjust this example (density.param, etc..) and eventually also<br />
include temperature Manipulators (for finite emittance) you can obtain<br />
an electron bunch with your desired properties after some initial<br />
acceleration. Then you just create a checkpoint and after a restart with<br />
a recompiled PIConGPU using a standard pusher you can directly use this<br />
electron bunch for your subsequent PWFA setting.</p>
</blockquote>
<h4 id="parameters-from-prl-120-254802-2018">Parameters from PRL <strong>120</strong> 254802 (2018)</h4>
<ul>
<li>LWFA stage, w. <code>CALDER-CIRC</code>
<ul>
<li>800 nm, 15 J, 30 fs (FWHM intensity) linearly polarized along <span class="math inline">\(x\)</span> axis, spot size 23 <span class="math inline">\(\mu\)</span>m FWHM int., <span class="math inline">\(a_0 = 6\)</span></li>
<li>speed of light in vaccum c = 0.2998 <span class="math inline">\(\mu\)</span>m/fs</li>
<li>laser angular frequency <span class="math inline">\(\omega_0\)</span> = 2.355 <del>rads</del>/fs; <span class="math inline">\(c/\omega_0 = 0.1273\)</span> <span class="math inline">\(\mu\)</span>m/<del>rad</del>; <span class="math inline">\(\omega_0^{-1} = 0.4246\)</span> fs/<del>rad</del></li>
<li>laser focal plane at the begining of the entrance ramp of the pre-ionized plasma</li>
<li>15 mm plasma, <span class="math inline">\(n_e = 1.75 \times 10^{18}\)</span> cm<span class="math inline">\({}^{-3}\)</span>, linear entrance ramp of 200 <span class="math inline">\(\mu\)</span>m</li>
<li>use 3 poloidal modes</li>
<li>Esirkepov algorithm with Boris pusher</li>
<li>moving window
<ul>
<li>3200x200 cells, 16 ppc, so <span class="math inline">\(1.02 \times 10^7\)</span> macro-particles</li>
<li><span class="math inline">\(\Delta z = 0.25\, c/\omega_0 = 31.83\)</span> nm longitudinal, <span class="math inline">\(\Delta r = 4 \, c/\omega_0 = 509.2\)</span> nm radial</li>
</ul></li>
<li>time step <span class="math inline">\(\Delta t = 0.249\, \omega_0^{-1} = 0.105\)</span> fs, total propagation length 22 mm</li>
</ul></li>
<li>Transition between stages
<ul>
<li>position and momenta of electrons recorded</li>
<li>low energy part (<span class="math inline">\(E &lt; 350\)</span> MeV) is filtered out</li>
<li>electron beam consists of <span class="math inline">\(1.2 \times 10^5\)</span> macro-particles</li>
<li>beam self-field is computed in the vacuum and initialized before the simulation starts</li>
</ul></li>
<li>PWFA stage, w. <code>CALDER</code>
<ul>
<li>3.3 mm preionized plasma, <span class="math inline">\(n_e = 1.1 \times 10^{20}\)</span> cm<span class="math inline">\({}^{-3}\)</span>, linear entrance ramp of 25 <span class="math inline">\(\mu\)</span>m
<ul>
<li><span class="math inline">\(n_{beam} &gt; 1.8 n_e\)</span> so <span class="math inline">\(n_e \leq 2 \times 10^{20}\)</span> cm<span class="math inline">\({}^{-3}\)</span> in order to generate wakefield</li>
<li>the 30 <span class="math inline">\(\mu\)</span>m long electron beam generates a current of tens of kA</li>
<li>max beam energy 2 GeV</li>
</ul></li>
<li>Esirkepov algorithm with Boris pusher</li>
<li>moving window
<ul>
<li>800x200x200 cells (z,x,y)</li>
<li><span class="math inline">\(\Delta z = \Delta x = \Delta y = 0.5\,c/\omega_0 = 63.65\)</span> nm</li>
</ul></li>
<li>time step <span class="math inline">\(\Delta t = 0.288\, \omega_0^{-1} = 0.122\)</span> fs</li>
<li>1 ppc, so <span class="math inline">\(3.2 \times 10^7\)</span> particles</li>
<li>vacuum propagation of electron beam for 65 <span class="math inline">\(\mu\)</span>m before it enters the plasma</li>
</ul></li>
<li>Single stage run, w. <code>CALDER</code>
<ul>
<li>2400x200x200 cells, 2ppc, so <span class="math inline">\(1.92 \times 10^8\)</span> macro-particles</li>
<li><span class="math inline">\(\Delta z = 0.25\,c/\omega_0 = 31.83\)</span> nm, <span class="math inline">\(\Delta x = \Delta y = 4 \, c/\omega_0 = 509.2\)</span> nm</li>
<li><span class="math inline">\(\Delta t = 0.248\, \omega_0^{-1} = 0.105\)</span> fs</li>
<li>200 <span class="math inline">\(\mu\)</span>m linear ramp followed by 19 mm plateau at <span class="math inline">\(n_e = 1 \times 10^{19}\)</span> cm<span class="math inline">\({}^{-3}\)</span></li>
</ul></li>
</ul>
<h3 id="running-the-lwfa-example-cetal-with-adios">Running the LWFA example @ CETAL with adios</h3>
<pre><code>pic-create $PIC_EXAMPLES/LaserWakefield $HOME/picInputs/adiosLWFA
pic-build -b &quot;cuda:60&quot;</code></pre>
<pre><code>diff -Naru etc/picongpu/8.cfg.old etc/picongpu/8.cfg

--- /home/andrei/picInputs/h5LWFA/etc/picongpu/8.cfg.old    2018-10-29 14:20:54.298800616 +0200
+++ etc/picongpu/8.cfg  2018-11-04 00:38:11.296744333 +0200
@@ -36,7 +36,7 @@
 TBG_devices_y=4
 TBG_devices_z=1
 
-TBG_gridSize=&quot;192 2048 160&quot;
+TBG_gridSize=&quot;512 2048 512&quot;
 TBG_steps=&quot;4000&quot;
 
 # leave TBG_movingWindow empty to disable moving window
@@ -68,12 +68,19 @@
           --hdf5.file simData \
           --hdf5.source &#39;species_all,fields_all&#39;&quot;
 
+# ADIOS raw data output (DISABLED, add to TBG_plugins below to ENABLE!)
+TBG_adios=&quot;--adios.period 100   \
+          --adios.file simData \
+          --adios.source &#39;species_all,fields_all&#39;&quot;
+
+
 # macro particle counter (electrons, debug information for memory)
 TBG_e_macroCount=&quot;--e_macroParticlesCount.period 100&quot;
 
 TBG_plugins=&quot;!TBG_pngYX                    \
              !TBG_e_histogram              \
              !TBG_e_PSypy                  \
+             !TBG_adios                    \
              !TBG_e_macroCount&quot;
 
 #################################</code></pre>
<pre><code>tbg -s bash -c etc/picongpu/8.cfg -t etc/picongpu/bash/mpiexec.tpl $SCRATCH/runs/lwfa_adios</code></pre>
<ul>
<li>simulation completes successfully – elapsed time: 1h 2m – occupied disk space: 1.8T</li>
</ul>
<h4 id="running-with-custom-libsplash">Running with custom <code>libSplash</code></h4>
<p>Follow instructions in <a href="https://github.com/ComputationalRadiationPhysics/picongpu/issues/2777#issuecomment-435843111">#2777 comment</a>:</p>
<ul>
<li>Add this to <code>$SPACK_ROOT/var/spack/repos/builtin/packages/libsplash/package.py</code>:</li>
</ul>
<pre><code>version(&#39;printHDF5ErrorStackOnWrite&#39;, branch=&#39;topic-printHDF5ErrorStackOnWrite&#39;, git=&#39;https://github.com/ax3l/libSplash.git&#39;)</code></pre>
<ul>
<li>In your <code>src/spack-repo/packages/picongpu/package.py</code>, loosen the constrain on <code>libSplash</code>:</li>
</ul>
<pre><code>depends_on(&#39;libsplash@1.7.0,printHDF5ErrorStackOnWrite&#39;, when=&#39;+hdf5&#39;)</code></pre>
<p>and then,</p>
<pre><code>spack install picongpu backend=cuda cppflags=&quot;-g&quot; ^libsplash@printHDF5ErrorStackOnWrite %gcc@7.3.0
spack load picongpu backend=cuda cppflags=&quot;-g&quot; ^libsplash@printHDF5ErrorStackOnWrite %gcc@7.3.0
export SPLASH_VERBOSE=99

pic-create $PIC_EXAMPLES/LaserWakefield $HOME/picInputs/HDF5ErrorStack

cd picInputs/HDF5ErrorStack/
pic-build -b &quot;cuda:60&quot;
cp ../adiosLWFA/etc/picongpu/8.cfg etc/picongpu/8.cfg

nohup tbg -s bash -c etc/picongpu/8.cfg -t etc/picongpu/bash/mpiexec.tpl $SCRATCH/runs/HDF5ErrorStack &amp;</code></pre>
<h3 id="installing-the-development-version-of-picongpu-via-spack">Installing the development version of PIConGPU via <code>Spack</code></h3>
<p>As mentioned in this <a href="https://github.com/ComputationalRadiationPhysics/picongpu/pull/2784#issuecomment-435777343/">comment</a>:</p>
<blockquote>
<p>you can always use a preview of <code>PIConGPU</code>, without <code>Changelog</code> and unannounced breaking changes, by using the <code>dev</code> branch via <code>spack install picongpu@develop</code> <code>spack uninstall</code> and <code>spack install</code> again for updates</p>
</blockquote>
<h3 id="nitrogen-based-lwfa-simulation">Nitrogen-based LWFA simulation</h3>
<ul>
<li>LWFA run output from Hypnos <a href="https://drive.google.com/file/d/1Kj-nqOjhq6pdQMuUAOW2LpNtUbv9mfPw/view?usp=sharing">on GDrive</a></li>
</ul>
<p><strong>Only in 002/Nitrogen</strong> <code>components.param</code> <code>particleFilters.param</code> <code>radiationObserver.param</code> <code>radiation.param</code> <code>speciesAttributes.param</code></p>
<p><strong>Differences</strong> - [x] <code>density.param</code> - [x] <code>fieldSolver.param</code> - [x] <code>grid.param</code> - [x] <code>laser.param</code> - [x] <code>particle.param</code> - [x] <code>png.param</code> - [x] <code>precision.param</code> - [x] <code>speciesDefinition.param</code> - [x] <code>speciesInitialization.param</code></p>
<pre><code>~/picInputs/Nitrogen$ nohup tbg -s bash -c etc/picongpu/64.cfg -t etc/picongpu/bash/mpiexec.tpl $SCRATCH/runs/Nitrogen &amp;</code></pre>
<ul>
<li>simulation completes successfully – elapsed time: 9h 20m – occupied disk space: 1.5T</li>
</ul>
<h3 id="useful-spack-commands">Useful <code>Spack</code> commands</h3>
<ul>
<li><code>$ spack spec -l /&lt;hash&gt;</code> to check dependencies</li>
<li><code>$ spack load /&lt;hash&gt;</code> to load a package by hash</li>
<li><p><code>$ spack find -d /hash</code> to see dependencies</p></li>
<li><a href="https://spack.readthedocs.io/en/latest/repositories.html">package repositories</a></li>
<li><a href="https://spack.readthedocs.io/en/latest/basic_usage.html#specs-dependencies">specs and dependencies</a></li>
<li></li>
</ul>
<h3 id="torque-job-scheduler-hypnos">Torque job scheduler (Hypnos)</h3>
<p>List of <a href="https://csdms.colorado.edu/wiki/Help:HPCC_Torque">commands</a>.</p>
<h3 id="openmpi">OpenMPI</h3>
<ul>
<li><code>mpirun --mca btl ^openib ...</code> in order to “disable” infiniband</li>
</ul>
<h3 id="hardware">Hardware</h3>
<ul>
<li>with 2 GTX 1080 Ti
<ul>
<li><code>FBPIC</code> 6000x250 with 3 poloidal modes</li>
<li><code>PIConGPU</code> 2000x200x200 with ionization and 1 ppc</li>
</ul></li>
</ul>
<h3 id="picongpu-params">PIConGPU params</h3>
<ul>
<li>default supercell <code>8x8x4</code></li>
<li>box is 1536x2880x1536; cubic cells <span class="math inline">\(\Delta x = \Delta y = \Delta z\)</span></li>
<li>3 ion species and 1 electron species (total of <span class="math inline">\(\sim 10^9\)</span> particles; simulation is field dominated)</li>
</ul>
<h3 id="git-commands">Git commands</h3>
<ul>
<li>checking out remote branch</li>
</ul>
<pre><code>$ git fetch
$ git checkout &lt;branch&gt;</code></pre>
<h3 id="bash">Bash</h3>
<ul>
<li>send message to all logged users</li>
</ul>
<pre><code>$ sudo wall -n hi</code></pre>
<ul>
<li>find different files between two directory trees</li>
</ul>
<pre><code>diff --brief -Nr dir1/ dir2/</code></pre>
</body>
</html>
